\section{Meilenstein 3 $-$ Spezifikation, Implementierung
  und Demo eines REST-API}

% Teilaufgabe 1 {{{
\subsection{Teilaufgabe 1: Festlegen von Aggregates}

\input{ms3/aggregates}

Wir sind der Meinung, dass sich die Datenobjekte Gericht,
Speise, Zubereitungsanleitung, Zutatenposition und Zutat
als ein Aggregate mit Gericht als Aggregate Root
zusammenfassen lassen, da keine Referenzen auf innere
Entities existieren und ein fachlicher Zusammenhang
besteht, da ein Gericht aus Speisen besteht, Speisen eine
Zubereitungsanleitung haben und diese wiederum
Zutatenpositionen, die auf Zutaten verweisen, ergibt sich
hier ein enges fachliches Geflecht. Au{\ss}erdem ist es so,
dass wir in Meilenstein 2 alle diese Objekte in der
Datenkomponente Gerichtsdaten (vgl. \ref{gos})
zusammengefasst haben, weshalb wir uns \"uberlegt haben,
dass das Aggregate durchaus deckungsgleich sein k\"onnte.

Eine m\"ogliche Invariante w\"are, wenn $Gericht.name$ eine
Kombination von den zugeh\"origen Speisen w\"are. Als
Beispiel hierf\"ur: $Gericht.name$: "`Schnitzel mit Pommes
und Salat"'. Daraus lassen sich die Speisen Schnitzel,
Pommes und Salat ableiten.
% }}}

% Teilaufgabe 2 {{{
\subsection{Teilaufgabe 2: Design des REST-API}

F\"ur unser REST-API verwenden wir folgenden Ausschnitt aus
unserem Klassendiagramm aus Meilenstein 1:

\input{ms3/extract}

\subsubsection*{Bemerkung}

Diese Schnittstelle w\"urde so in unserem Subsystem nicht
implementiert, da die verwendeten Gesch\"aftsobjekte nicht
in unser Subsystem geh\"oren und wir sie deshalb selbst
\"uber Schnittstellen aus anderen Subsystemen beziehen.
Wir bieten nur eine Schnittstelle f\"ur das
Gesch\"aftsobjekt Bestellung f\"ur die Buchhaltung an (vgl.
\ref{ms2_3}) und mit nur einem Gesch\"aftsobjekt l\"asst
sich das angegebene Szenario nicht durchf\"uhren, weshalb
wir den obrigen Ausschnitt verwenden.


\begin{tabu} to \linewidth {l|l|X|X|X}
% Headerzeile {{{
\hline
\rowcolor{codebordercolor}
Szen.-Nr. &URI &HTTP Verb &Request-Body &Ressource und
  Aktion \\
% }}}
% A1, A5, BC1 {{{
\hline
A1, A5, BC1 &/gerichte/\{gericht\_id\} &PUT, DELETE
  &\textbf{Nur bei Put:}
    \{
      name=\dots,
      details=\dots,
      preis=\dots
    \}
  &Neues Gericht anlegen, Gericht
  \"uberschreiben, Gericht l\"oschen. \\
% }}}
% A2, A4 {{{
\hline
A2, A4 &/gerichte?filter[preis]$>$\{wert\} &GET & &Alle
  Gerichte $a$ ausgeben, f\"ur die $a.preis > wert$ gilt.
  \\
% }}}
% A3 {{{
\hline
A3 &/gerichte/\{gericht\_id\}/preis &PUT &\{wert\} &Preis
  von Gericht $a$ mit $a.gericht\_id=\{gericht\_id\}$ auf
  $\{wert\}$ setzen. \\
% }}}
% A6 {{{
\hline
A6 &/gerichte/\{gericht\_id\}/id &GET & &Id von Gericht
  abfragen. 404 wird geworfen, falls Gericht nicht
  vorhanden. \\
% }}}
% BC2 {{{
\hline
BC2 &/speisen/\{speise\_id\} &PUT &\{name=\dots\} &Speise
  anlegen, \"uberschreiben. \\
% }}}
% BC3, BC6 {{{
\hline
BC3, BC6 &/gerichte/\{gericht\_id\}/speisen &PUT, DELETE
  &\{speise\_id=\dots\} &Speise einem Gericht hinzuf\"ugen
  oder l\"oschen.
  \\
% }}}
% BC4, BC7 {{{
\hline
BC4, BC7 &/gerichte &GET & &Alle Gerichte ausgeben. \\
% }}}
% BC5 {{{
\hline
BC5 &/speisen &GET & &Alle Speisen ausgeben. \\
% }}}
\hline
\end{tabu}

\subsubsection*{Bemerkung}

Bei Szenario BC3 und BC6 haben wir uns entschieden, dass
die Beziehung zwsichen einer Instanz von Gericht und einer
Instanz von Speise \"uber /gerichte/\{gericht\_id\}/speisen
hinzugef\"ugt oder gel\"oscht weren kann. Man h\"atte dies
auch \"uber /speisen/\{speisen\_id\}/gerichte tun k\"onnen,
was wir jedoch f\"ur un\"ubersichtlicher und nicht so
naheliegend wie unsere Variante gehalten haben.

% }}}

\newpage

% Teilaufgabe 3 {{{
\subsection{Teilaufgabe 3: Implementierung in Spring Data
  JPA / Web MVC}

% Code-Listing {{{
\subsubsection{Code-Listing}

% GerichtRESTController {{{
\begin{mdframed}[style=codebox]
\textbf{GerichtRESTController}
\lstinputlisting[
  language=Java,
  firstline=34,
  lastline=134
]{%
  ../code/ms3RESTSpringDemo/src/main/java/%
  ms3restspringdemo/services/GerichtRestController%
  .java
}
\end{mdframed}
% }}}

% SpeiseRESTController {{{
\begin{mdframed}[style=codebox]
\textbf{SpeiseRESTController}
\lstinputlisting[
  language=Java,
  firstline=28,
  lastline=43
]
{%
  ../code/ms3RESTSpringDemo/src/main/java/%
  ms3restspringdemo/services/SpeiseRestController%
  .java
}
\end{mdframed}
% }}}

% }}}

% Nachweis der Lauffaehigkeit {{{
\subsubsection{Nachweis der Lauff\"ahigkeit}

Ausgaben der Postman Logs sind in Anhang A zu finden.

% }}}

% }}}
